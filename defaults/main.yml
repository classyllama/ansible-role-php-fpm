---
# Valid values are 55, 56, 70 and 71
php_version: 70

# List of php modules to install
php_modules:
  - cli
  - common
  - devel
  - fpm
  - gd
  - imap
  - mbstring
  - mcrypt
  - mysqlnd
  - opcache
  - pdo
  - soap
  - xml
  - xmlrpc

php_fpm_pool: www-data

php_fpm_owner: "{{ php_fpm_pool }}"
php_fpm_group: "{{ php_fpm_pool }}"

php_fpm_listen_user: "{{ php_fpm_owner }}"
php_fpm_listen_group: "{{ php_fpm_group }}"
php_fpm_listen_host: 127.0.0.1
php_fpm_listen_mode: "0660"

php_fpm_mb_per_thread: 196
php_fpm_memory_percentage: 100

php_fpm_pm: static
php_fpm_pm_max_children: "{{ (php_fpm_memory_percentage / 100 * ansible_memtotal_mb / php_fpm_mb_per_thread)|int }}"
php_fpm_pm_max_requests: 5000
php_fpm_pm_idle_timeout: 20s
php_fpm_status_path: /php-status
php_fpm_catch_workers_output: "yes"

php_fpm_log_dir: /var/log/php-fpm
php_fpm_slowlog: "{{ php_fpm_log_dir }}/{{ php_fpm_pool }}-slow.log"

php_fpm_ini:
  php_flag[display_errors]: "off"
  php_admin_flag[log_errors]: "on"
  php_admin_value[error_log]: "{{ php_fpm_log_dir }}/{{ php_fpm_pool }}-error.log"
  php_admin_value[memory_limit]: 512M

php_fpm_global_ini:
  memory_limit: 1G
